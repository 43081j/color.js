<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<title>Color conversion tests</title>
<link rel="stylesheet" href="https://test.mavo.io/style.css" />
<script src="https://blissfuljs.com/bliss.shy.js"></script>
<script src="https://test.mavo.io/test.js"></script>

<script src="../color.js" type="module"></script>
<script src="../src/spaces/hwb.js" type="module"></script>
<script>
function colorConvertHWBtosRGB() {
	let td = document.currentScript.parentNode.previousElementSibling;
	print(() => {
		var color = new Color(td.textContent);
		return color.to("srgb").coords.join(", ");
	});
}
function colorConvertsRGBtoHWB() {
	let td = document.currentScript.parentNode.previousElementSibling;
	print(() => {
		var color = new Color(td.textContent);
		return color.to("hwb");
	});
}
function colorConvertsRGBtoHSL() {
	let td = document.currentScript.parentNode.previousElementSibling;
	print(() => {
		var color = new Color(td.textContent);
		return color.to("hsl");
	});
}
</script>

</head>
<body>

<h1>Color conversion Tests</h1>
<p>These tests parse different color formats and then print out the coordinates in various color spaces.</p>

<section>
	<h1>sRGB to LCH</h1>
	<table class="reftest" data-test="colorConvertLCH" data-columns="3">
		<tr>
			<td>slategray</td>
			<td>52.69726481080971, 11.234142037623341, 253.00052666481292</td>
		</tr>
	</table>
</section>

<section>
	<h1>HWB to sRGB</h1>
	<table class="reftest" data-test="fuzzyNumbers" data-columns="3">
		<tr>
			<td>hwb(0 20% 40%)</td>
			<td>
				<script>
				colorConvertHWBtosRGB();
				</script>
			</td>
			<td><!--#993333--> 0.6, 0.2, 0.2</td>
		</tr>
		<tr>
			<td>hwb(90 30% 5%)</td>
			<td>
				<script>
				colorConvertHWBtosRGB();
				</script>
			</td>
			<td>0.625, 0.950, 0.300 </td>
		</tr>
		<tr>
			<!-- angles can be outside [0 to 360) -->
			<td>hwb(720 20% 40%)</td>
			<td>
				<script>
				colorConvertHWBtosRGB();
				</script>
			</td>
			<td><!--#993333--> 0.6, 0.2, 0.2</td>
		</tr>
		<tr>
			<td>hwb(-270 30% 5%)</td>
			<td>
				<script>
				colorConvertHWBtosRGB();
				</script>
			</td>
			<td>0.625, 0.950, 0.300 </td>
		</tr>
		<tr>
			<!-- white and black normalize to less than 100% -->
			<td>hwb(0 40% 80%)</td>
			<td>
				<script>
				colorConvertHWBtosRGB();
				</script>
			</td>
			<td><!--#993333--> 0.3333333, 0.3333333, 0.3333333</td>
		</tr>
	</table>
</section>

<section>
	<h1>sRGB to HWB</h1>
	<table class="reftest" data-test="fuzzyNumbers" data-columns="3">
		<tr>
			<td>rgb(60% 20% 20%)</td>
			<td>
				<script>
					colorConvertsRGBtoHWB();
				</script>
			</td>
			<td>hwb(0 20% 40%)</td>
		</tr>
		<tr>
			<td>black</td>
			<td>
				<script>
					colorConvertsRGBtoHWB();
				</script>
			</td>
			<td>hwb(0 0% 100%)</td>
		</tr>
		<tr>
			<td>white</td>
			<td>
				<script>
					colorConvertsRGBtoHWB();
				</script>
			</td>
			<td>hwb(0 100% 0%)</td>
		</tr>
	</table>
</section>

<section>
	<h1>sRGB to HSL</h1>
	<table class="reftest" data-test="fuzzyNumbers" data-columns="3">
		<tr>
			<td>black</td>
			<td>
				<script>
					colorConvertsRGBtoHSL();
				</script>
			</td>
			<td>hsl(0 0% 0%)</td>
		</tr>
		<tr>
			<td>white</td>
			<td>
				<script>
					colorConvertsRGBtoHSL();
				</script>
			</td>
			<td>hsl(0 0% 100%)</td>
		</tr>
	</table>
</section>

<section>
	<h1>Get coordinates</h1>
	<table class="reftest" data-test="fuzzyNumbers">
		<tr title="color.chroma">
			<td>
				<script>
					print(() => {
						var color = new Color("slategray");
						return color.chroma
					});
				</script>
			</td>
			<td>11.234142037623341</td>
		</tr>
		<tr title="color.lch[1]">
			<td>
				<script>
					print(() => {
						var color = new Color("slategray");
						return color.lch[1];
					});
				</script>
			</td>
			<td>11.234142037623341</td>
		</tr>
		<tr title="color.lch.chroma">
			<td>
				<script>
					print(() => {
						var color = new Color("slategray");
						return color.lch.chroma;
					});
				</script>
			</td>
			<td>11.234142037623341</td>
		</tr>
	</table>
</section>

<script>
function colorConvertLCH(...rest) {
	return colorConvert("lch", ...rest);
}

function colorConvert(id, test, result, expected) {
	var err;

	try {
		var color = new Color(test.textContent);
		let coords = color[id];
		result.textContent = Array.isArray(coords)? coords.join(", ") : coords;
		result.color = color;

		if (Test.equals(result.textContent, expected.textContent)) {
			return true;
		}
	}
	catch(e) {
		result.textContent = result.color = err = e;
	}

	return err || false;
}
</script>

</body>
</html>
