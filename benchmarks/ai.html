<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Benchmark</title>
</head>
<body>

<canvas id="colorjs_canvas" width="300" height="400"></canvas>
<canvas id="culori_canvas" width="300" height="400"></canvas>

<script type="module">

function test(lib, canvas, f) {
	let ctx = canvas.getContext("2d")
	let i=0, j=0;
	let timeTaken = {create: 0, in: 0, str: 0};

	for (let h = 0; h <= 360; h += 1) {
		for (let l = 0; l <= 1; l+=.05) {
			for (let c = 0; c <= 0.4; c+=.01) {
				let start;
				start = performance.now();
				let color = f.create(l, c, h);
				timeTaken.create += performance.now() - start;

				start = performance.now();
				let inSRGB = f.in(color);
				timeTaken.in += performance.now() - start;

				let colorStr;

				if (inSRGB) {
					start = performance.now();
					colorStr = f.str(color, inSRGB);
					timeTaken.str += performance.now() - start;
				}

				if (inSRGB) {
					ctx.fillStyle = colorStr;

					let x = i % 300;
					let y = (i - x) / 300;

					ctx.fillRect(x, y, 1, 1);
					i++;
				}
				j++;

			}
		}

		//console.log(`${h}/360 done, taken ${timeTaken}ms so far`);
	}

	let totalTime = timeTaken.create + timeTaken.in + timeTaken.str;
	console.log(`${lib}: ${i}/${j} colors in gamut, took ${totalTime}ms (${timeTaken.create}ms creation, ${timeTaken.in} in gamut check, ${timeTaken.str} serialization)`);
}

import Color from "../src/color.js";
import oklch from "../src/spaces/oklch.js";
import "../src/deltaE/deltaE2000.js";

test("Color.js", colorjs_canvas, {
	create: (l, c, h) => new Color('oklch', [l, c, h]),
	in: color => color.inGamut("srgb"),
	str: color => color.to("srgb").toString()
});


import { displayable, formatRgb } from 'https://cdn.skypack.dev/culori';

test("culori", culori_canvas, {
	create: (l, c, h) => ({ mode: 'oklch', l, c, h }),
	in: color => displayable(color),
	str: color => formatRgb(color)
});


</script>
</body>
</html>